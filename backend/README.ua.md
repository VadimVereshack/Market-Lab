# 🏗️ Структура домену (універсальна)

## 📁 {domain}.dto.ts
**Для чого:** Типи для вхідних даних ззовні (API, форми)  
**Чому:** Відокремлюємо зовнішній світ від внутрішньої логіки  
*// Що отримуємо від клієнта*

## 📁 {domain}.type.ts
**Для чого:** Внутрішні типи домену  
**Чому:** Типобезпека всередині системи, не залежать від API  
*// Як зберігаємо та працюємо всередині*

## 📁 {domain}.entity.ts
**Для чого:** Бізнес-логіка та поведінка сутності  
**Чому:** Інкапсуляція правил (створення, оновлення, деактивація)  
*// Що сутність МОЖЕ робити*

## 📁 {domain}.repository.ts
**Для чого:** Контракт для роботи з БД  
**Чому:** Відокремлюємо логіку від способу зберігання  
*// Як зберігаємо/отримуємо дані*

## 📁 {domain}.service.ts
**Для чого:** Координація операцій та валідація  
**Чому:** Єдина точка входу для роботи з сутністю  
*// Що можна ЗРОБИТИ з сутністю*

---

## 🎯 Принцип розділення:

- **DTO** ↔ Зовнішній світ
- **Service** ↔ Що робимо  
- **Entity** ↔ Як поводиться
- **Repository** ↔ Де зберігаємо
- **Types** ↔ Як описуємо

**Кожен файл знає ЛИШЕ про свою зону відповідальності! ✅**

---

## 💡 Ключова ідея:
Кожен шар має свою єдину відповідальність і не має знати про зайві деталі інших шарів. Це робить код гнучким, тестованим і легким для підтримки.


# Карта потоку даних
```
┌─────────────────────────────────────────────────────────────┐
│                    SHARED LAYER                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              BaseRepository<T>                      │    │
│  │  (універсальний контракт для ВСІХ репозиторіїв)     │    │
│  │                                                     │    │
│  │  create(data: Partial<T>): Promise<T>               │    │
│  │  findById(id: string): Promise<T | null>            │    │
│  │  update(id: string, data: Partial<T>): Promise<T>   │    │
│  │  delete(id: string): Promise<void>                  │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
                                △
                            implements
                                │
┌─────────────────────────────────────────────────────────────┐
│                    DOMAIN LAYER                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │           CustomerRepository                        │    │
│  │  (доменна абстракція + специфічні методи)           │    │
│  │                                                     │    │
│  │  abstract findByEmail(email: string)                │    │
│  │  abstract create(customer: CustomerEntity)          │    │
│  │  abstract update()                                  │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │           CustomerEntity                            │    │
│  │  (багата модель з бізнес-логікою)                   │    │
│  │                                                     │    │
│  │  update(updateDto: UpdateCustomerDto): void         │    │
│  │  activate(): void                                   │    │
│  │  deactivate(): void                                 │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
                                △
                             extends
                                │
┌─────────────────────────────────────────────────────────────┐
│               INFRASTRUCTURE LAYER                          │
│  ┌─────────────────────────────────────────────────────┐    │
│  │         PostgresCustomerRepository                  │    │
│  │  (конкретна реалізація для PostgreSQL)              │    │
│  │                                                     │    │
│  │  constructor(@InjectRepository(...))                │    │
│  │  async findByEmail(email: string)                   │    │
│  │  async create(customer: CustomerEntity)             │    │
│  │  async update(id: string, customer: CustomerEntity) │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```
## SHARED → Стандартизація (всі репозиторії однакові)
## DOMAIN → Ізоляція бізнес-логіки (не залежить від БД)
## INFRASTRUCTURE → Гнучкість реалізації (можемо міняти БД)
### Кожен шар знає лише про шар вище !!!


# Flow реєстрації (/auth/register)
```
          ┌─────────────────────┐
          |   Клієнт (Frontend) |
          └─────────────────────┘
                    |
            POST /auth/register
  { email, password, type(role), profileData }
                    |
                    v
      ┌──────────────────────────────┐
      |   AuthService.register()     |
      └──────────────────────────────┘
                    |
                    | 1. Хешує пароль
                    | 2. Створює user
                    v
┌────────────────────────────────────────────┐
|                 TABLE user                 |
+--------------------------------------------+
| id (PK)                                    |
| email                                      |
| passwordHash                               |
| roles[]  ← ['customer'] або ['supplier']   |
└────────────────────────────────────────────┘
                    |
                    | user.id
                    v
      ┌───────────────────────────┐
      |  Вибір типу профілю       |
      └───────────────────────────┘
             |               |
             |               |
    якщо type=customer  якщо type=supplier
             |               |
             v               v
┌───────────────────┐  ┌────────────────────────┐
| customer_profile  |  |   supplier_profile     |
+-------------------+  +------------------------+
| id (PK)           |  | id (PK)                |
| userId (FK)       |  | userId (FK)            |
| firstName         |  | companyName            |
| lastName          |  | edrpou                 |
| phone             |  | address                |
|                   |  | documents (jsonb)      |
└───────────────────┘  └────────────────────────┘
              |               |
              └───────────────┘
                      |
                      v
            ┌───────────────────┐
            |   Реєстрація OK   |
            +-------------------+
            | user + profile    |
            └───────────────────┘
```